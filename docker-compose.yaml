version: '3.8'
services:
  planner-backend:
    image: ghcr.io/adan-garcia/planner-backend:latest
    container_name: vite-react-backend
    ports:
      - "443:3001"
      - "81:3001"
    restart: always
    volumes:
      - /planner/backend:/app/data
      - /cert.pem:/app/ssl/cert.pem:ro
      - /key.pem:/app/ssl/key.pem:ro
    environment:
      - NODE_ENV=production
      - PORT=3001
      - USE_HTTPS=true
      - SSL_CERT_PATH=/app/ssl/cert.pem
      - SSL_KEY_PATH=/app/ssl/key.pem
      - ORIGINS=https://planner.adangarcia.com,http://localhost:3000,https://api.adangarcia.com,https://homework.adangarcia.com
      - DB_PATH=/app/data/planner.db
      - SESSION_TTL_MS=86400000
      - MAX_META_SIZE=2048
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${HOME}/.docker:/config:ro
    environment:
      - DOCKER_API_VERSION=1.44
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=120
      - WATCHTOWER_INCLUDE_RESTARTING=true
      - DOCKER_CONFIG=/config
    restart: always
